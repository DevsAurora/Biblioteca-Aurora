generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Livro {
  id             BigInt    @id @default(autoincrement())
  titulo         String    @db.VarChar(200)
  autor          String    @db.VarChar(150)
  ano_publicacao Int?
  genero         String?   @db.VarChar(100)
  isbn           String    @unique @db.VarChar(20)
  criado_em      DateTime? @default(now()) @db.Timestamp(6)
  atualizado_em  DateTime @updatedAt @db.Timestamp(6)

  exemplar Exemplar[]
}

model Usuario {
  id            BigInt    @id @default(autoincrement())
  nome          String    @db.VarChar(100)
  sobrenome     String?   @db.VarChar(100)
  email         String    @unique @db.VarChar(150)
  senha         String    @db.VarChar(200)
  role          Role      @default(ALUNO)
  criado_em     DateTime? @default(now()) @db.Timestamp(6)
  atualizado_em DateTime @updatedAt @db.Timestamp(6)

  emprestimos  Emprestimo[]
}

enum Role {
  ALUNO
  BIBLIOTECARIO
  PROFESSOR
}

model Exemplar { // campos id, livro_id, status, relação com Livro 1:N Exemplar
  id            BigInt    @id @default(autoincrement())
  livro_id      BigInt
  codigo_tombo  String    @unique @db.VarChar(50) // identificação única da cópia física
  status        Status
  livro         Livro     @relation(fields: [livro_id], references: [id])

  emprestimos   Emprestimo[]
}

enum Status {
  DISPONIVEL
  EMPRESTADO
  RESERVADO
  ATRASADO
}

model Emprestimo { // campos id, usuario_id, exemplar_id, data_emprestimo, data_devolucao_prevista, data_devolucao_real, relação com Usuario 1:N Emprestimo, Exemplar 1:N Emprestimo
  id                      BigInt    @id @default(autoincrement())
  usuario_id              BigInt
  exemplar_id             BigInt
  data_emprestimo         DateTime  @default(now()) @db.Timestamp(6)
  data_devolucao_prevista DateTime  @db.Timestamp(6)
  data_devolucao_real     DateTime? @db.Timestamp(6)
  
  usuario                 Usuario   @relation(fields: [usuario_id], references: [id])
  exemplar                Exemplar  @relation(fields: [exemplar_id], references: [id])
}